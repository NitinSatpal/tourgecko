<div class="hostHome sessionDetails" id="tourBookingDetails">
	<div id="tourBookingDetails" class="container-fluid ">
		<div class="row body-content">
			<div class="col-md-12 col-sm-12 col-lg-12">
				<div ng-include="'/modules/hosts/client/views/tour-booking-details/top-nav-tourBookingDetails.client.view.html'"></div>
				<div class="row booking-analytics">
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 ">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 card text-center">
                            <h1 class="orange-text booking-analytics-icon">&#8377;</h1>    
                            <div class="text-center booking-analytics-info">    
                                <p class="section-desc">Amount</p>
                                <h4>{{vm.totalRevenue}}</h4>
                            </div>    
                        </div>    
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 card text-center">
	                        <h1 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-time"></i></h1>    
	                        <div class="text-center booking-analytics-info">
                                <p class="section-desc" id="tourStartsIn" style="display: none;">Starts in</p>
                                <p class="section-desc" id="tourEndsIn" style="display: none;">Ends in</p>
                                <p class="section-desc" id="tourEnded" style="display: none;">Ended</p>
                                <span class="sub-desc" id="remainingTime"></span>           
		                        <!--<p class="section-desc" ng-if="vm.startsIn">Starts in</p>
                                <p class="section-desc" ng-if="vm.starting">Starting</p>
                                <p class="section-desc" ng-if="vm.started">Started</p> 
                                <p class="section-desc" ng-if="vm.ending">Ending</p>
                                <p class="section-desc" ng-if="vm.ended">Ended</p>                          
		                        <h4 class="">{{vm.getDaysRemainingToStartOfTour(vm.productSession.sessionDepartureDetails.startDate, vm.productSession.product.productDuration)}}&nbsp;
                                    <span class="sub-desc" ng-if="vm.startsIn">days</span>
                                    <span class="sub-desc" ng-if="(vm.started || vm.ended) && !vm.singularityInDay">days ago</span>
                                    <span class="sub-desc" ng-if="(vm.started || vm.ended) && vm.singularityInDay">day ago</span>
                                </h4>-->
	                        </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-6">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 card text-center">
                            <h1 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-calendar-check"></i></h1>    
                            <div class="text-center booking-analytics-info">           
	                            <p class="section-desc">Confirmed</p>
	                            <h4 class="" ng-show="vm.confirmedBookings <= 1">{{vm.confirmedBookings}}&nbsp;<span class="sub-desc">Booking</span></h4>
                                <h4 class="" ng-show="vm.confirmedBookings > 1">{{vm.confirmedBookings}}&nbsp;<span class="sub-desc">Bookings</span></h4>
                            </div>
                        </div>
                    </div>
                </div>
                        
                <div class="outline col-lg-12 col-md-12 col-sm-12 col-xs-12 margin-top margin-bottom padding-top padding-bottom ">
                    <div class="col5 col-sm-6 col-xs-6 booking-trip-start">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center ">
                            <h2 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-calendar-alt"></i></h2> <br>   
                            <div class="text-left booking-analytics-info">           
                            <p class="sub_desc">Trip Start Date</p>
                            <h5 class="">
                            	{{vm.getDisplayDate(vm.productSession.sessionDepartureDetails.startDate, vm.productSession.product.productDuration)}}&nbsp;
	                            <span class="sub_desc">
	                            	{{vm.getDisplayMonthAndYear(vm.productSession.sessionDepartureDetails.startDate, vm.productSession.product.productDuration)}}
	                            </span>
                            </h5>
                             </div>
                        </div>
                    </div> 
                    <div class="col5 col-sm-6 col-xs-6">
                       	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                            <h2 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-calendar-check"></i></h2> <br>   
                            <div class="text-left booking-analytics-info">           
                            <p class="sub_desc">Trip End Date</p>
                            <h5 class="">{{vm.tourEndDate}}&nbsp;<span class="sub_desc">{{vm.tourEndMonthAndYear}}</span></h5>
                             </div>
                        </div>
                    </div> 
                    <div class="col5 col-sm-6 col-xs-6">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                            <h2 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-airline-seat-recline-normal check"></i></h2> <br>   
                            <div class="text-left booking-analytics-info">           
                            <p class="sub_desc">Confirmed</p>
                            <h5 class="">{{vm.confirmedSeats}}&nbsp;<span class="sub_desc">Seats</span></h5>
                             </div>
                        </div>
                    </div> 
                    <div class="col5 col-sm-6 col-xs-6">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                            <h2 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-airline-seat-recline-normal"></i></h2> <br> 
                            <div class="text-left booking-analytics-info">           
                            <p class="sub_desc">Seats Available</p>
                            <h5 class="text-center">{{vm.getSeatsAvailability()}}&nbsp;&nbsp;<!--<span class="sub_desc"><a href="#">Update</a></span>--></h5>
                            </div>
                        </div>
                    </div> 
                    <div class="col5 col-sm-6 col-xs-6">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                            <h2 class="orange-text booking-analytics-icon"><i class="zmdi zmdi-flight-takeoff"></i></h2> <br>
                            <div class="text-left booking-analytics-info">           
                            <p class="sub_desc">Departure Type</p>
                            <h5 class="">{{vm.productSession.product.productAvailabilityType}}&nbsp;<span class="sub_desc"></span></h5>
                             </div>
                        </div>
                    </div>      
                </div>
                        
                <div class="margin-top">
                   	<ul class="nav nav-tabs">
                      	<li class="active"><a data-toggle="tab" href="#current-tour-bookings">Bookings</a></li>
                      	<li><a data-toggle="tab" href="#current-tour-guests">Guests</a></li>
                   	</ul>
                    <ul class="pull-right print-email" >
                        <li>
                            <a href="">
                                <i class="zmdi zmdi-floppy" data-toggle="tooltip" data-placement="top" title="Save"></i>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <i class="zmdi zmdi-print" data-toggle="tooltip" data-placement="top" title="Print"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- tab content begins -->
               	<div class="tab-content">
                  	<div id="current-tour-bookings" class="tab-pane fade in active" print-section>
                        <ul class="nav-bookings sessionDetailsFilterNav" ng-if="vm.bookings.length > 0 || (vm.bookings.length == 0 && vm.filterApplied)">
                            <li id="allBookings" class="inline-block margin-right active">
                                <a href="" ng-click="vm.categorizedBooking('All', true)" onclick="showLoaderForFilters('#allBookings')">All</a>
                            </li>
                            <li id="pendingBookings" class="inline-block margin-right">
                                <a href="#" ng-click="vm.categorizedBooking('Pending', true)" onclick="showLoaderForFilters('#pendingBookings')">Pending</a>
                            </li>
                            <li id="confirmedBookings" class="inline-block margin-right">
                                <a href="#" ng-click="vm.categorizedBooking('Confirmed', true)" onclick="showLoaderForFilters('#confirmedBookings')">Confirmed</a>
                            </li>
                            <li id="cancelledBookings" class="inline-block margin-right">
                                <a href="#" ng-click="vm.categorizedBooking('Cancelled', true)" onclick="showLoaderForFilters('#cancelledBookings')">Cancelled</a>
                            </li>
                        </ul>
                    	<div id="sessionBookingDetails" ng-repeat="booking in vm.bookings track by $index" ng-click="vm.goToBookingDetailScreen($index)">
							<div class="card">
	                    		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 border-bottom margin-bottom padding-top padding-bottom">
	                        		<div class="col-lg-6 col-md-6 col-sm-12 col-xs-6">
	                         			<h5>Booking Id: <strong>{{booking.bookingReference}}</strong></h5>
	                        		</div>
	                       			<div class="col-lg-6 col-md-6 col-sm-12 col-xs-6">
	                         			<a class="pull-right booking-user">
	                         				<img alt="user image" src="{{booking.user ? booking.user.profileImageURL : '/modules/users/client/img/profile/default.png'}}" class="margin-right booking-user-image">{{booking.providedGuestDetails.firstName.length + booking.providedGuestDetails.lastName.length > 15 ? booking.providedGuestDetails.firstName : booking.providedGuestDetails.firstName + '&nbsp;' + booking.providedGuestDetails.lastName}}
	                         			</a>
	                        		</div>
	                     		</div>
	                   			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 padding-top">
	                       			<div class="col-lg-2 text-center margin-bottom">
	                       				<div class="redBookingCircle bookingcircle booking-status-icon margin-auto" ng-show="booking.bookingStatus == 'Declined'">
	                                		<i class="zmdi zmdi-calendar-close margin-top"></i>
	                            		</div>
	                           
			                            <div class="orangeBookingCircle bookingcircle booking-status-icon margin-auto" ng-show="booking.bookingStatus == 'Pending'">
			                            	<i class="zmdi zmdi-time-interval margin-top"></i>
			                           	</div>
			                           	<div class="greenBookingCircle bookingcircle booking-status-icon margin-auto" ng-show="booking.bookingStatus == 'Confirmed'">
			                               	<i class="zmdi zmdi-case-check margin-top"></i>
			                           	</div>
                                        <div class="greyBookingCircle bookingcircle booking-status-icon margin-auto" ng-show="booking.bookingStatus == 'Cancelled'">
                                            <i class="zmdi zmdi-case-check margin-top"></i>
                                        </div>
                                        <br>
			                            <span class="sub_desc">{{booking.bookingStatus}}</span>
	                       			</div>
	                       			<div class="col-lg-6">
	                       				<ul class="cleared card-booking-details margin-top">
                                            <li>
                                                <span class="content-primary">Created on</span>
                                                <span class="content-secondary">{{vm.getFullDisplayDate(booking.created)}}</span>
                                            </li>    
                                            <li>
                                                <span class="content-primary">Tour</span>
                                                <span class="content-secondary">{{booking.product.productTitle}}</span>
                                            </li>
                                            <li>
                                                <span class="content-primary">Departure</span>
                                                <span class="content-secondary">{{booking.isOpenDateTour == true ? booking.openDatedTourDepartureDate : vm.getFullDisplayDate(booking.productSession.sessionDepartureDetails.startDate)}} {{booking.actualSessionTime != 'No Time' ? booking.actualSessionTime : ''}}</span>
                                            </li>
                                            <li>
                                                <span class="content-primary">No. of seats</span>
                                                <span class="content-secondary">{{booking.numberOfSeats}}</span>
                                            </li>
                                            <li>
                                                <span class="content-primary">Amount</span>
                                                <span class="content-secondary"><strong class="orange-text">{{booking.totalAmountPaid}}</strong></span>
                                            </li>
	                       					
	                       				</ul>
	                       			</div>
	                    		</div>   
							</div>
						</div>
                        <div class="row text-center">
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <div class="pagination" ng-if="vm.pageTo > 1">
                                    <a href="#" ng-click="vm.decrementWindowSize()" style="margin-right: 5px;">&laquo;</a>
                                    <a href="#" ng-click="vm.decrementPageNumber()" style="margin-right: 10px;">&lsaquo;</a>
                                    <a href="#" ng-if="vm.totalPages > vm.paginationWindow && !vm.showAtLast" ng-click="vm.changePageNumber(0)"> 1 </a>
                                    <a ng-if="vm.totalPages > vm.paginationWindow && !vm.showAtLast">...</a>
                                    <a href="#" ng-repeat="page in vm.pageCounterArray.slice(vm.pageFrom,vm.pageTo) track by $index" ng-class="{active: vm.pageFrom + $index + 1 == vm.currentPageNumber}" ng-click="vm.changePageNumber(vm.pageFrom + $index)">{{vm.pageFrom + $index + 1}}</a>
                                    <a ng-if="vm.totalPages > vm.paginationWindow && vm.showAtLast">...</a>
                                    <a href="#" ng-if="vm.totalPages > vm.paginationWindow && vm.showAtLast" ng-click="vm.changePageNumber(vm.totalPages - 1)"> {{vm.totalPages}} </a>
                                    
                                    <a href="#" ng-click="vm.incrementPageNumber()" style="margin-left: 10px;">&rsaquo;</a>
                                    <a href="#" ng-click="vm.incrementWindowSize()" style="margin-left: 5px;">&raquo;</a>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12" ng-if="vm.bookings.length > 5">
                                <span> Show &nbsp; 
                                    <select ng-model="vm.numberOfItemsInOnePage" ng-change="vm.changeItemsPerPage(vm.numberOfItemsInOnePage)">
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                    </select>
                                    &nbsp; bookings per page
                                </span>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12 empty-data-Image-one" ng-if="vm.bookings.length == 0 && !vm.filterApplied">
                                <span> <h4> There are no bookings for this session yet. </h4></span>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12 empty-data-Image-one" ng-if="vm.bookings.length == 0 && vm.filterApplied">
                                <span> <h4> No bookings found </h4></span>
                            </div>
                        </div>
                   	</div>
                    <div id="current-tour-guests" class="tab-pane fade in">
                        <div class="table-responsive" ng-show="vm.guestData.length > 0">
                            <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Booking Ref.</th>
                                    <th>Booking date</th>
                                  </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="detail in vm.guestData track by $index">
                                        <td>{{detail.providedGuestDetails.firstName}} {{detail.providedGuestDetails.lastName}}</td>
                                        <td>{{detail.providedGuestDetails.email}}</td>
                                        <td>{{detail.providedGuestDetails.mobile}}</td>
                                        <td>{{detail.bookingReference}}</td>
                                        <td>{{vm.getBookingDate($index)}}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div>
                                <a class="sub_btn btn btn-primary pull-left" style="background: #40C4FF;" ng-hide="vm.skipIndexForGuestData == 0" ng-click="vm.getNewSetOfGuestData(vm.skipIndexForGuestData - 1)">
                                    <i class="zmdi zmdi-chevron-left"></i>&nbsp;&nbsp;Prev
                                </a>
                                <a class="sub_btn btn btn-primary pull-right" style="background: #40C4FF;" ng-show="vm.skipIndexForGuestData != vm.lastIndexForGuestData" ng-click="vm.getNewSetOfGuestData(vm.skipIndexForGuestData + 1)">
                                    Next &nbsp;&nbsp;<i class="zmdi zmdi-chevron-right"></i>
                                </a>
                            </div>
                        </div>
                        <br>
                        <br>
                        <div class="col-sm-12 col-md-12 col-lg-12 text-center" ng-if="vm.guestData.length == 0">
                            <span> <h4> No guests record found </h4></span>
                        </div>
                    </div>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="bookingFilterMobileModal" class="modal bookingFilterMobileModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content bookingFilterMobileModalContent">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#bookingFilterMobileModal').toggle('slow')"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Select the filter optionss!</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="filter-checkbox-one" class="" ng-model="vm.selectedFiltersForBookingRecords[0]">
                            <label for="filter-checkbox-one"></label>
                            <span class="filterName">Pending</span>
                        </div>
                    </div>
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="filter-checkbox-two" class="" ng-model="vm.selectedFiltersForBookingRecords[1]">
                            <label for="filter-checkbox-two"></label>
                            <span class="filterName">Confirmed</span>
                        </div>
                    </div>
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-top: 10px;">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="filter-checkbox-three" class="" ng-model="vm.selectedFiltersForBookingRecords[2]">
                            <label for="filter-checkbox-three"></label>
                            <span class="filterName">Declined</span>
                        </div>
                    </div>
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-top: 10px;">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="filter-checkbox-four" class="" ng-model="vm.selectedFiltersForBookingRecords[3]">
                            <label for="filter-checkbox-four"></label>
                            <span class="filterName">Cancelled</span>
                        </div>
                    </div>
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-top: 10px;">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="filter-checkbox-five" class="" ng-model="vm.selectedFiltersForBookingRecords[4]">
                            <label for="filter-checkbox-five"></label>
                            <span class="filterName">Expired</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer modalFooterContent">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6" >
                        <button type="button" class="btn btn-warning btn-Select-filter" ng-click="vm.applySelectedFiltersOnBookingRecords()">Apply Filters</button>
                    </div>
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-6" >
                        <button type="button" class="btn btn-default btn-Clear-filter" ng-click="vm.clearAllFilterOnBookingRecords()">Clear Filters</button>
                    </div>
                </div>
                <div class="row">
                    <div  class="col-lg-6 col-md-6 col-sm-6 col-xs-12 RememberFilters"  style="margin-top: 30px;">
                        <div class="o-checkbox">
                            <input type="checkbox" value="None" name="" id="remember-filters" class="" ng-change="vm.setFilterPreferences()" ng-model="vm.rememberFilterPreferences">
                            <label for="remember-filters"></label>
                            <span class="filterName">Remember my filter preferences</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- CSS -->
<link media="print" rel="stylesheet" href="lib/angularPrint/angularPrint.css">

<!-- JS -->
<script src="lib/angularPrint/angularPrint.js"></script>
<script>
    $(document).ready(function(){
        $(this).scrollTop(0);
    });
    $(document).ready(function() {
        $(this).scrollTop(0);
        $('#filter-dropdown-button').css("border-bottom-color","lightgrey")
        $('#filter-dropdown-button').css("border-bottom-right-radius", "3px");
        $('#filter-dropdown-button').css("border-bottom-left-radius", "3px");
    });

    $(document).on("click", "#filter-dropdown-button", function(event) {
        if ($("#filter-dropdown").hasClass("open")) {
            $('#filter-dropdown-button').css("border-bottom-color","transparent");
            $('#filter-dropdown-button').css("border-bottom-right-radius", "0px");
            $('#filter-dropdown-button').css("border-bottom-left-radius", "0px");
        } else {
            $('#filter-dropdown-button').css("border-bottom-color","lightgrey")
            $('#filter-dropdown-button').css("border-bottom-right-radius", "3px");
            $('#filter-dropdown-button').css("border-bottom-left-radius", "3px");
        }
    });

    $(document).on("click", "#filter-options", function(event) {
        event.stopPropagation();
    });

    $(document).on("click", function(event) {
        $('#filter-dropdown-button').css("border-bottom-color","lightgrey")
        $('#filter-dropdown-button').css("border-bottom-right-radius", "3px");
        $('#filter-dropdown-button').css("border-bottom-left-radius", "3px");
    });

    function changeCSSForSessionBookingFilterButton() {
        $('#filter-dropdown-button').css("border-bottom-color","lightgrey")
        $('#filter-dropdown-button').css("border-bottom-right-radius", "3px");
        $('#filter-dropdown-button').css("border-bottom-left-radius", "3px");
    }
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });

    if (window.innerWidth < 767) {
        $(".booking-filters .fa").css("display", "none");
        $("#filter-dropdown-button").attr("data-toggle", "");
    }
    $(document).on("click", "#filter-dropdown-button", function() {
        if (window.innerWidth < 767) {
            $("#bookingFilterMobileModal").toggle("slow");
        }
    });
    var callingSecondTime = false;
    function initializeRemainingTimeCounter (startDate, endDate) {
        // Set the date we're counting down to
        var countDownDate = new Date(startDate).getTime();

        // Update the count down every 1 second
        var x = setInterval(function() {

            // Get todays date and time
            var now = new Date().getTime();
            
            // Find the distance between now an the count down date
            var distance = countDownDate - now;
            
            // Time calculations for days, hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            // Output the result in an element with id="demo"
            document.getElementById("remainingTime").innerHTML = days + "d " + hours + "h "
            + minutes + "m " + seconds + "s ";
            
            if (callingSecondTime) {
                $('#tourStartsIn').css('display', 'none');
                $('#tourEndsIn').css('display', 'block');
            } else {
                $('#tourStartsIn').css('display', 'block');
            }
            // If the count down is over, write some text 
            if (distance < 0) {
                if (!callingSecondTime) {
                    callingSecondTime = true;
                    initializeRemainingTimeCounter(endDate, null);
                }
                clearInterval(x);
                if(!callingSecondTime)
                    document.getElementById("remainingTime").innerHTML = "Already Started";
                else {
                    $('#tourStartsIn').css('display', 'none');
                    $('#tourEndsIn').css('display', 'none');
                    $('#tourEnded').css('display', 'block');
                    document.getElementById("remainingTime").innerHTML = "00:00:00:00";
                }
            }
        }, 1000);
    }

    function showLoaderForFilters (id) {
        $(".nav-bookings").find(".active").removeClass("active");
        $(id).addClass('active');
        $(".nav-bookings a").css('text-decoration', 'none');
        $('#loadingDivHostSide').css('display', 'block');
        $('#tourgeckoBody').addClass('waitCursor');
    }
</script>